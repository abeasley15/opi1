!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}var r=function(){function t(i){e(this,t),i=i||".card.active .errors",this.errors=document.querySelector(i),this.errorList=[]}return i(t,[{key:"add",value:function(e){var t=document.createElement("div");t.className="error";var i=document.createTextNode(e);t.appendChild(i),this.errorList.push(t)}},{key:"clear",value:function(){this.errors.innerHTML=""}},{key:"show",value:function(){var e=this;this.clear(),this.errorList.forEach((function(t){e.errors.appendChild(t)}))}}]),t}(),n=new(function(){function t(){e(this,t),this.controller=null,this.ratingCardSelector=".card-rating",this.starRatingSelector='.card-rating input[name="rate"]:checked',this.starRatingSubmitButtonSelector='.card-rating button[type="submit"]',this.handleSubmit=this.handleSubmit.bind(this)}return i(t,[{key:"loadView",value:function(e){this.controller=e,this.starRatingSubmitButton=document.querySelector(this.starRatingSubmitButtonSelector),this.starRatingSubmitButton.addEventListener("click",this.handleSubmit)}},{key:"hideView",value:function(){this.ratingCard=document.querySelector(this.ratingCardSelector),this.ratingCard.style.display="none",this.ratingCard.classList.remove("active")}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=document.querySelector(this.starRatingSelector),i=new r;if(null==t)return i.add("Please select your star rating"),void i.show();i.clear(),this.controller.handleSubmit(t.value)}}]),t}()),a=new(function(){function t(i){var r=i.view,n=i.data;e(this,t),this.view=r,this.data=n}return i(t,[{key:"start",value:function(e){this.mainController=e,this.globalSetting=e.setting,this.loadView()}},{key:"handleSubmit",value:function(e){e<this.globalSetting.minimumRating?this.mainController.loadSurveyUrl():this.mainController.showReviewCard()}},{key:"loadView",value:function(){this.view.loadView(this)}},{key:"hideView",value:function(){this.view.hideView()}}]),t}())({view:n,data:null}),o=new(function(){function t(){e(this,t),this.reviewIcons=[{name:"google",icon:"fab fa-google"},{name:"yelp",icon:"fab fa-yelp"},{name:"facebook",icon:"fab fa-facebook-f"}],this.demoReviewUrls={google:"https://g.page/r/CVA8LRLaGr5uEAg/review",yelp:"https://www.yelp.com/writeareview/biz/-accA_FLBFxqkMLspa_JDQ",facebook:"https://www.facebook.com/ctxdumpsters/reviews/"},this.reviewUrls=window.reviewUrls}return i(t,[{key:"getReviewSiteIcon",value:function(e){return this.reviewIcons.find((function(t){return e==t.name}))}},{key:"_generateReviews",value:function(e){var t=[];for(var i in e)if(e[i]){var r=this.getReviewSiteIcon(i);r||console.log("Warning: review site icon not found"),t.push({name:r.name,icon:r.icon,url:e[i]})}else console.log("Warning: review provider not found");return t}},{key:"getReviewSites",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.reviewUrls;return e&&(t=this.demoReviewUrls),this._generateReviews(t)}}]),t}()),s=new(function(){function t(){e(this,t),this.reviewCardSelector=".card.card-review"}return i(t,[{key:"loadView",value:function(e,t){this.controller=e,this.data=t,this.reviewCard=document.querySelector(this.reviewCardSelector),this.reviewCard.classList.add("active"),this.createReviewLinks(t.reviewSites),this.reviewCard.style.display="block"}},{key:"hideView",value:function(){this.reviewCard.style.display="none",this.reviewCard.classList.remove("active")}},{key:"createReviewLink",value:function(e){var t=e.name,i=e.url,r=e.icon,n=e.svg,a=document.createElement("a");return a.className="review-link ".concat(t,"-review-link"),a.href=i,a.referrerPolicy="no-referrer",a.target="_blank",n&&(a.innerHTML=n),r&&(a.innerHTML='<div class="social-icon social-bg-'.concat(t,'"><i class="').concat(r,'"></i></div>')),a}},{key:"createReviewLinks",value:function(e){var t=this,i=document.querySelector(".review-link-container"),n=new r;if(void 0===e||0==e.length)return n.add("No review sites in settings"),void n.show();e.forEach((function(e){var r=t.createReviewLink(e);i.appendChild(r)}))}}]),t}()),l=new(function(){function t(i){var r=i.view,n=i.model;e(this,t),this.view=r,this.model=n}return i(t,[{key:"loadView",value:function(){var e={reviewSites:this.model.getReviewSites()};this.view.loadView(this,e)}},{key:"hideView",value:function(){this.view.hideView()}}]),t}())({view:s,model:o});new(function(){function t(i){var r=i.ratingController,n=i.reviewController;e(this,t),this.setting={orderIdParam:"orderid",defaultMinimumRating:5,defaultFolderName:"opi1",defaultOrderId:"1009"};var a=this.getOrderId(),o=this.getFolderName();this.setting.minimumRating=this.getMinimumRating(),this.setting.orderid=a,this.setting.folderName=o,this.setting.surveyUrl="https://".concat(o,".ourers.com/take-survey/").concat(a,"/survey/"),this.ratingController=r,this.reviewController=n}return i(t,[{key:"start",value:function(){var e=this;document.addEventListener("DOMContentLoaded",(function(){return e.ratingController.start(e)}))}},{key:"getMinimumRating",value:function(){var e=window.minimumRating;return e||this.setting.defaultMinimumRating}},{key:"getFolderName",value:function(){var e=window.folderName;return e||this.setting.defaultFolderName}},{key:"getOrderId",value:function(){var e=new URLSearchParams(window.location.search).get(this.setting.orderIdParam);return e||this.setting.defaultOrderId}},{key:"showReviewCard",value:function(){this.ratingController.hideView(),this.reviewController.loadView()}},{key:"loadSurveyUrl",value:function(){location.assign(this.setting.surveyUrl)}}]),t}())({ratingController:a,reviewController:l}).start()}();

